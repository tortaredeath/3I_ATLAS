name: Set Progress When Issue Created

on:
  issues:
    types: [opened]

jobs:
  set-progress:
    runs-on: ubuntu-latest

    steps:
      - name: Show trigger info
        run: |
          echo "Action: ${{ github.event.action }}"
          echo "Issue number: ${{ github.event.issue.number }}"
          echo "Labels: ${{ toJson(github.event.issue.labels) }}"

      - name: Add issue to project and set Progress = Todo
        env:
          GH_TOKEN: ${{ secrets.GH_PROJECT_TOKEN }}   # ‰Ω†Ë¶ÅÂú® secrets Âª∫Á´ãÈÄôÂÄã Token
          ISSUE_ID: ${{ github.event.issue.node_id }}
        run: |
          echo "Issue node id: $ISSUE_ID"

          echo "üìå Â∞á Issue Âä†ÂÖ• Project‚Ä¶"

          gh api graphql -f query='
            mutation($project:ID!, $item:ID!) {
              addProjectV2ItemById(input:{
                projectId:$project
                contentId:$item
              }) {
                item {
                  id
                }
              }
            }
          ' -f project=PVT_kwH0ADBtMs4BJYJc -f item="$ISSUE_ID"

          echo "üìå Ë®≠ÂÆö Progress = Todo‚Ä¶"

          gh api graphql -f query='
            mutation($project:ID!, $item:ID!, $field:ID!, $option:String!) {
              updateProjectV2ItemFieldValue(input:{
                projectId: $project
                itemId: $item
                fieldId: $field
                value: {
                  singleSelectOptionId: $option
                }
              }) {
                projectV2Item {
                  id
                }
              }
            }
          ' \
          -f project=PVT_kwH0ADBtMs4BJYJc \
          -f item="$ISSUE_ID" \
          -f field=PVTSSF_LAHOADB tMs4BJYJczg5j9EA \
          -f option=7434d06d

      - name: Done
        run: echo "üöÄ Progress Â∑≤Ëá™ÂãïË®≠ÁÇ∫ TodoÔºÅ"
